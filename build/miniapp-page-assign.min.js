"use strict";var proxyKeys=[];var proxyVal="";var setData=function setData(self){if(!self){return}if(!self.data){self.data={}}if(self.setData){var data={};var keysStr=proxyKeys.join(".");data[keysStr]=proxyVal;self.setData(data);proxyKeys=[];proxyVal=""}};var addProxy=function addProxy(obj,self){if(Object.prototype.toString.call(Proxy)=="[object Undefined]"){console.warn("The Proxy is not supported, try to upgrade wechat.");wx.showModal({title:"提示",content:"当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。"});return{}}return new Proxy(obj,{get:function get(target,key){if(target[key]&&Object.prototype.toString.call(target[key])=="[object Object]"){proxyKeys.push(key);return addProxy(target[key],self)}else{proxyKeys=[];return target[key]}},set:function set(target,key,value){target[key]=value;proxyKeys.push(key);proxyVal=value;setData(self);return true}})};var setRoute=function setRoute(){var routeInfo=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{query:{}};var self=arguments[1];if(wx.$route){Object.keys(wx.$route).forEach(function(key){if(!routeInfo[key]){routeInfo[key]=wx.$route[key]}});routeInfo.fromQuery=JSON.parse(JSON.stringify(wx.$route.query));routeInfo.fromPageLen=wx.$route.pageLen||0;routeInfo.fromPagePath=wx.$route.pagePath||""}routeInfo.pageLen=getCurrentPages().length;var page=getCurrentPages().pop();var pagePath=void 0;if(page){pagePath=page.__route__}routeInfo.pagePath=pagePath;wx.$route=routeInfo;if(self){self.$route=wx.$route}};var checkVersion=function checkVersion(){if(wx.getUpdateManager){var updateManager=wx.getUpdateManager();updateManager.onUpdateReady(function(readyCb){wx.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success:function success(res){if(res.confirm){updateManager.applyUpdate()}}})});updateManager.onUpdateFailed(function(failedCb){console.warn("Present version is not now but upgrade fail.")})}else{console.warn("Please update miniapp version more than 1.9.90")}};var pageAssign=function pageAssign(config){var _this=this;if(!config)config={};if(Object.prototype.toString.call(config.data)!="[object Object]"){config.data={}}if(Object.prototype.toString.call(config.methods)!="[object Object]"){config.methods={}}if(!Array.isArray(config.mixin)){config.mixin=[]}var callbackList=["onLoad","onShow","onReady","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage","onPageScroll","onTabItemTap"];if(config.mixin.length>0){config.mixin.forEach(function(mixItem){if(Object.prototype.toString.call(mixItem.data)=="[object Object]"){config.data=Object.assign(config.data,mixItem.data)}if(Object.prototype.toString.call(mixItem.methods)=="[object Object]"){config.methods=Object.assign(config.methods,mixItem.methods)}})}var forbidMethods=[].concat(callbackList);Object.keys(config).forEach(function(item){if(item=="data"){_this.data=config["data"]}else if(item=="methods"){Object.keys(config[item]).forEach(function(method){if(forbidMethods.indexOf(method)!=-1){console.error("method ["+method+"] is a reserved word")}else{_this[method]=config[item][method]}})}else if(item=="mixin"){}else{if(forbidMethods.indexOf(item)!=-1){_this["_"+item]=config[item]}else{console.warn("method ["+item+"] is suggest register in methods");_this[item]=config[item]}}});this.onLoad=function(options){this.$data=addProxy(this.data,this);setRoute({query:options},this);if(this._onLoad){this._onLoad(options)}};this.onShow=function(){if(this._onShow){this._onShow()}};this.onReady=function(){if(this._onReady){this._onReady()}};this.onHide=function(){if(this._onHide){this._onHide()}};this.onUnload=function(){if(this._onUnload){this._onUnload()}};this.onPullDownRefresh=function(){if(this._onPullDownRefresh){this._onPullDownRefresh()}};this.onReachBottom=function(){if(this._onReachBottom){this._onReachBottom()}};this.onShareAppMessage=function(obj){if(this._onShareAppMessage){return this._onShareAppMessage(obj)}else{return{title:"集合派",path:"/pages/index/index",imageUrl:"https://jihepai-pro.oss-cn-hangzhou.aliyuncs.com/static/img/logo-square.jpeg"}}};this.onPageScroll=function(obj){if(this._onPageScroll){this._onPageScroll(obj)}};this.onTabItemTap=function(obj){if(this._onTabItemTap){this._onTabItemTap(obj)}};this.onModel=function(event){if(!event){return}var key=event.currentTarget.dataset.key;var value=event.currentTarget.dataset.value;if(value==undefined){value=event.detail.value}if(!key){return}this.$data[key]=value}};module.exports={setRoute:setRoute,pageAssign:pageAssign,checkVersion:checkVersion};